<div class="transition duration-300">
  <main class="p-4 min-h-2/4 container m-auto mt-10">
    <!-- -----------------------FIRST CONTAINER------------------------------ -->
    <div class="flex justify-between my-4 text-xl tracking-wide items-center">
      <h2 class="font-extrabold uppercase text-[#052C13] drop-shadow-md">
        Usuarios
      </h2>
      <app-btn (click)="toggleAddUser()"> Alta usuario </app-btn>
    </div>

    <!-- -----------------------ADD MODAL------------------------------ -->
    <app-modal-wrapper
      [visible]="showAddUser"
      title="Crear nuevo usuario"
      (close)="toggleAddUser()"
    >
      <app-add-user #addUser (userAdded)="onUserAdded()"></app-add-user>
    </app-modal-wrapper>

    <div>
      <!-- Filtro para busqueda -->
      <!-- <form class="max-w-md mx-auto">
        <label for="default-search" class="mb-2 text-green-900 sr-only"
          >Search</label
        >

        <div class="relative">
          <div
            class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none"
          >
            <svg
              class="w-4 h-4 text-green-950"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 20 20"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"
              />
            </svg>
          </div>

          <input
            type="search"
            id="default-search"
            class="block !w-full !p-4 !ps-10 text-sm input-class mb-4"
            placeholder="Search tasks..."
            required
            formControlName="email"
          />
        </div>
      </form> -->
    </div>

    <!-- -----------------------USERS LIST------------------------------ -->
    <div class="relative overflow-x-auto shadow-lg rounded-2xl mb-4 z-20">
      <table class="w-full text-left rtl:text-right">
        <thead class="text-white uppercase bg-dg tracking-wide">
          <tr>
            <th class="px-6 py-3">Nombre</th>
            <th class="px-6 py-3">Email</th>
            <th class="px-6 py-3">Roles</th>
            <th class="px-3 py-3">Activo</th>
            <th class="px-3 py-3">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <!-- Recorremos con Ã­ndice -->
          <ng-container *ngFor="let user of filteredUsers; let i = index">
            <!-- Fila de datos -->
            <tr class="bg-slate-50 hover:bg-gray-50 border-b border-gray-200">
              <td class="px-6 py-4">{{ user.name }}</td>
              <td class="px-6 py-4">{{ user.email }}</td>
              <td class="px-6 py-4">
                <span *ngFor="let role of user.roles; let last = last">
                  {{ getRoleDisplayName(role) }}<span *ngIf="!last">, </span>
                </span>
              </td>

              <td class="px-3 py-4">
                <label class="inline-flex items-center cursor-pointer">
                  <input
                    type="checkbox"
                    class="sr-only peer"
                    [checked]="user.active"
                    (change)="toggleUserActive(user)"
                  />
                  <div
                    class="relative w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-500 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-800 "                    
                  ></div>
                </label>
              </td>

              <td class="px-3 py-4 w-20 inline-flex">
                <button
                  class="m-1 cursor-pointer p-2 rounded-lg hover:bg-green-100 transition"
                  (click)="toggleEdit(i, user)"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    height="24px"
                    viewBox="0 -960 960 960"
                    width="24px"
                    fill="#000000"
                  >
                    <path
                      d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z"
                    />
                  </svg>
                </button>

                <button
                  class="m-1 cursor-pointer p-2 rounded-lg hover:bg-green-100 transition"
                  (click)="deleteUser(user.id!)"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    height="24px"
                    viewBox="0 -960 960 960"
                    width="24px"
                    fill="#000000"
                  >
                    <path
                      d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"
                    />
                  </svg>
                </button>
              </td>
            </tr>

            <!-- Fila con modal: solo si currentEditRow === i -->
            <tr *ngIf="currentEditRow === i">
              <td colspan="5" class="p-0 bg-transparent">
                <div class="p-4 bg-slate-100 rounded-b-2xl shadow-inner">
                  <app-modal-edit
                    [user]="editingUser!"
                    (save)="saveEdit($event)"
                    (cancel)="cancelEdit()"
                  ></app-modal-edit>
                </div>
              </td>
            </tr>
          </ng-container>

          <!-- Mensaje si no hay usuarios -->
          <tr *ngIf="filteredUsers.length === 0">
            <td
              colspan="5"
              class="p-4 text-center text-xl font-bold text-green-900"
            >
              No hay usuarios que mostrar
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>
</div>
